<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Installation Overview - SecureDrop</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../css/extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">SecureDrop</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Installation <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li class="active">
                            <a href="./">Installation Overview</a>
                        </li>
                    
                        <li >
                            <a href="../hardware/">Hardware Requirements</a>
                        </li>
                    
                        <li >
                            <a href="../deployment_practices/">Deployment Practices</a>
                        </li>
                    
                        <li >
                            <a href="../ubuntu_config/">Server Config</a>
                        </li>
                    
                        <li >
                            <a href="../network_firewall/">Network Firewall</a>
                        </li>
                    
                        <li >
                            <a href="../ossec_alerts/">OSSEC Alerts</a>
                        </li>
                    
                        <li >
                            <a href="../yubikey_setup/">Yubikey Setup</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Support <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../source_user_manual/">Source User Manual</a>
                        </li>
                    
                        <li >
                            <a href="../../journalist_user_manual/">Journalist User Manual</a>
                        </li>
                    
                        <li >
                            <a href="../../admin_interface/">Admin User Manual</a>
                        </li>
                    
                        <li >
                            <a href="../../tails_guide/">Using Tails</a>
                        </li>
                    
                        <li >
                            <a href="../../google_authenticator/">Google Authenticator</a>
                        </li>
                    
                        <li >
                            <a href="">Upgrading SecureDrop</a>
                        </li>
                    
                        <li >
                            <a href="../../tails_printing_guide/">Printing with Tails</a>
                        </li>
                    
                        <li >
                            <a href="../../terminology/">Terminology</a>
                        </li>
                    
                        <li >
                            <a href="../../threat_model/">Threat Model</a>
                        </li>
                    
                        <li >
                            <a href="../../training_schedule/">Training Schedule</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contributing <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../develop/">Development Environment</a>
                        </li>
                    
                        <li >
                            <a href="">Running the Tests</a>
                        </li>
                    
                        <li >
                            <a href="../../apparmor_profiles/">AppArmor Profiles</a>
                        </li>
                    
                        <li >
                            <a href="../../creating_deb/">Building .deb packages</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li >
                    <a rel="next" href="../..">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../hardware/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#installing-securedrop">Installing SecureDrop</a></li>
        
            <li><a href="#before-you-begin">Before you begin</a></li>
        
            <li><a href="#set-up-the-secure-viewing-station">Set up the Secure Viewing Station</a></li>
        
            <li><a href="#set-up-admin-tails-usb-and-workstation">Set up Admin Tails USB and Workstation</a></li>
        
            <li><a href="#set-up-the-network-firewall">Set up the Network Firewall</a></li>
        
            <li><a href="#set-up-the-servers">Set up the Servers</a></li>
        
            <li><a href="#install-the-securedrop-application">Install the SecureDrop application</a></li>
        
            <li><a href="#finalizing-the-installation">Finalizing the Installation</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="installing-securedrop">Installing SecureDrop</h1>
<p>This guide outlines the steps required to install SecureDrop 0.3.x. If you are looking to upgrade from version 0.2.1, please use the <a href="../../migration_scripts/0.3">migration scripts</a> we have created.</p>
<h2 id="before-you-begin">Before you begin</h2>
<p>When running commands or editing configuration files that include filenames, version numbers, userames, and hostnames or IP addresses, make sure it all matches your setup. This guide contains several words and phrases associated with SecureDrop that you may not be familiar with. A basic familiarity with Linux, the GNU core utilities and Bash shell is highly advantageous. It's recommended that you read our <a href="terminology.md">Terminology Guide</a> once before starting and keep it open in another tab to refer back to.</p>
<p>You will also need the inventory of hardware items for the installation listed in our <a href="../hardware/">Hardware Guide</a>.</p>
<h3 id="set-up-tails-usb-sticks">Set up Tails USB sticks</h3>
<p>Before installing the SecureDrop application, the first thing you need to do is set up several USB sticks with the Tails operating system. Tails is a privacy-enhancing live operating system that runs on removable media, such as a DVD or a USB stick. It sends all your Internet traffic through Tor, does not touch your computer's hard drive, and securely wipes unsaved work on shutdown.</p>
<p>You'll need to install Tails onto at least four USB sticks and enable persistent storage, which is an encrypted volume that allows you to save information even when Tails securely wipes everything else:</p>
<ol>
<li>
<p><em>offline Tails USB</em></p>
</li>
<li>
<p><em>admin Tails USB</em></p>
</li>
<li>
<p><em>journalist Tails USB</em>.</p>
</li>
<li>
<p><em>long-term storage Tails USB</em></p>
</li>
</ol>
<p>You will need one Tails USB for each journalist, so if you have more than one journalist checking SecureDrop, you'll need to create even more. It's a good idea to label or color-code these in order to tell them apart.</p>
<h4 id="installing-tails">Installing Tails</h4>
<p>We recommend creating an initial Tails Live DVD or USB, and then using that to create additional Tails Live USBs with the <em>Tails Installer</em>, a special program that is only available from inside Tails. <em>You will only be able to create persistent volumes on USB sticks that had Tails installed via the Tails Installer</em>.</p>
<p>The <a href="https://tails.boum.org/">Tails website</a> has detailed and up-to-date instructions on how to download and verify Tails, and how to create a bootable Tails USB stick. Follow the instructions at these links and then return to this page:</p>
<ul>
<li><a href="https://tails.boum.org/download/index.en.html">Download and verify the Tails .iso</a></li>
<li><a href="https://tails.boum.org/doc/first_steps/installation/index.en.html">Install onto a USB stick or SD card</a></li>
</ul>
<p>Note that this process will take some time because once you have one copy of Tails, you have to create each additional Tails USB, shut down, and boot into each one to complete the next step.</p>
<p>Also, you should be aware that Tails doesn't always completely shut down and reboot properly when you click "restart", so if you notice a signficant delay, you may have to manually power off and restart your computer for it to work properly.</p>
<h4 id="enabling-persistence-storage-on-tails">Enabling Persistence Storage on Tails</h4>
<p>Creating an encrypted persistent volume will allow you to securely save information and settings in the free space that is left on your Tails USB. This information will remain available to you even if you reboot Tails. (Tails securely erases all other data on every shutdown.)</p>
<p>You will need to create a persistent storage on each Tails USB, with a unique password for each.</p>
<p>Please use the instructions on the <a href="https://tails.boum.org/doc/first_steps/persistence/index.en.html">Tails website</a> to make the persistent volume on each Tails USB stick you create.</p>
<p>When creating the persistence volume, you will be asked to select from a list of features, such as 'Personal Data'. We recommend that you enable <strong>all</strong> features.</p>
<p>Some other things to keep in mind:</p>
<ul>
<li>
<p>You will want to create a persistent volume for all three main Tails USBs: the <em>offline Tails USB</em>, the <em>admin Tails USB</em>, and the <em>journalist Tails USB</em>.</p>
</li>
<li>
<p>The admin and the journalist should create separate passwords for their own USBs.</p>
</li>
<li>
<p>Only the journalist should have access to the <em>offline Tails USB password</em>, though during the initial installation, often the admin will create their own password to facilitate setup and then the journalist can change it afterwards.</p>
</li>
<li>
<p>Unlike many of the other passphrases for SecureDrop, the persistence volume passwords must be remembered by the admin and journalist. So after creating each passphrase, you should write it down until you can memorize it, and then destroy the paper you wrote it on.</p>
</li>
</ul>
<p>NOTE: Make sure that you never use the <em>offline Tails USB</em> on a computer connected to the Internet or a local network. This USB will be used on the air-gapped <em>Secure Viewing Station</em> only.</p>
<h2 id="set-up-the-secure-viewing-station">Set up the Secure Viewing Station</h2>
<p>The <em>Secure Viewing Station (SVS)</em> is a computer that is kept offline and only ever used together with the <em>offline Tails USB</em>. Since this machine will never touch the Internet or run an operating system other than Tails on a USB, it does not need a hard drive or network device.</p>
<p>We recommend that you physically remove the hard drive and networking cards, such as wireless and Bluetooth, from this machine. If you are unable to remove a card, place tape over the port or otherwise physically disable it. If you have questions about using an older machine for this purpose, please contact us at securedrop@freedom.press.</p>
<p>At this point, you should have created a Tails Live USB with persistence on the <em>offline Tails USB</em>. If you haven't, follow the instructions in the first half of our <a href="tails_guide.md">Tails Guide</a>.</p>
<p>Boot your <em>offline Tails USB</em> on the <em>Secure Viewing Station</em>.</p>
<p>After it loads, you should see a "Welcome to Tails" screen with two options. Select <em>Yes</em> to enable the persistent volume and enter your password, but do NOT click Login yet. Under 'More Options,' select <em>Yes</em> and click <em>Forward</em>.</p>
<p>Enter an <em>Administration password</em> for use with this specific Tails session and click <em>Login</em>. (NOTE: the <em>Administration password</em> is a one-time password. It will reset every time you shut down Tails.)</p>
<h3 id="create-a-gpg-key-for-the-securedrop-application">Create a GPG key for the SecureDrop application</h3>
<p>When a document or message is submitted to SecureDrop by a source, it is automatically encrypted with the SecureDrop Application GPG key. You will need to create that key now before you continue with the installation.</p>
<p>After booting up Tails, you will need to manually set the system time before you create the GPG key. To set the system time, right-click the time in the top menu bar and select <em>Adjust Date &amp; Time.</em></p>
<p>Click <em>Unlock</em> in the top-right corner of the dialog window and enter your <em>Administration password.</em> Set the correct time, region and city.</p>
<p>Then click <em>Lock</em>, enter your password one more time and wait for the system time to update in the top panel.</p>
<p>Once that's done, follow the steps below to create a GPG key.</p>
<ul>
<li>Open a terminal <img alt="Terminal" src="../images/terminal.png" /> and run <code>gpg --gen-key</code></li>
<li>When it says, <code>Please select what kind of key you want</code>, choose <code>(1) RSA and RSA (default)</code></li>
<li>When it asks, <code>What keysize do you want?</code> type <strong><code>4096</code></strong></li>
<li>When it asks, <code>Key is valid for?</code> press Enter to keep the default</li>
<li>When it asks, <code>Is this correct?</code> verify that you've entered everything correctly so far, and type <code>y</code></li>
<li>For <code>Real name</code> type: <code>SecureDrop</code></li>
<li>For <code>Email address</code>, leave the field blank and press Enter</li>
<li>For <code>Comment</code> type <code>[Your Organization's Name] SecureDrop Application GPG Key</code></li>
<li>Verify that everything is correct so far, and type <code>o</code> for <code>(O)kay</code></li>
<li>It will pop up a box asking you to type a passphrase, but it's safe to click okay without typing one (since your persistent volume is encrypted, this GPG key is already protected)</li>
<li>Wait for your GPG key to finish generating</li>
</ul>
<p>To manage GPG keys using the graphical interface (a program called Seahorse), click the clipboard icon <img alt="gpgApplet" src="../images/gpgapplet.png" /> in the top right corner and select "Manage Keys". You should see the key that you just generated under "GnuPG Keys."</p>
<p><img alt="My Keys" src="../images/install/keyring.png" /></p>
<p>Select the key you just generated and click "File" then "Export". Save the key to the <em>Transfer Device</em> as <code>SecureDrop.pgp</code>, and make sure you change the file type from "PGP keys" to "Armored PGP keys" which can be switched right above the 'Export' button. Click the 'Export' button after switching to armored keys.</p>
<p>NOTE: This is the public key only.</p>
<p><img alt="My Keys" src="../images/install/exportkey.png" />
<img alt="My Keys" src="../images/install/exportkey2.png" /></p>
<p>You'll need to verify the fingerprint for this new key during the <code>App Server</code> installation. Double-click on the newly generated key and change to the <code>Details</code> tab. Write down the 40 hexadecimal digits under <code>Fingerprint</code>. (Your GPG key fingerprint will be different than what's in this photo.)</p>
<p><img alt="Fingerprint" src="../images/install/fingerprint.png" /></p>
<h3 id="import-gpg-keys-for-journalists-with-access-to-securedrop">Import GPG keys for journalists with access to SecureDrop</h3>
<p>While working on a story, journalists may need to transfer some documents or notes from the <em>Secure Viewing Station</em> to the journalist's work computer on the corporate network. To do this, the journalists should re-encrypt them with their own keys. If a journalist does not already have a personal GPG key, he or she can follow the same steps above to create one. The journalist should store the private key somewhere safe; the public key should be stored on the <em>Secure Viewing Station</em>.</p>
<p>If the journalist does have a key, transfer their public key from wherever it is located to the <em>Secure Viewing Station</em>, using the <em>Transfer Device</em>. Open the file manager <img alt="Nautilus" src="../images/nautilus.png" /> and double-click on the public key to import it. If the public key is not importing, rename the file to end in ".asc" and try again.</p>
<p><img alt="Importing Journalist GPG Keys" src="../images/install/importkey.png" /></p>
<p>At this point, you are done with the <em>Secure Viewing Station</em> for now. You can shut down Tails, grab the <em>admin Tails USB</em> and move over to your regular workstation.</p>
<h2 id="set-up-admin-tails-usb-and-workstation">Set up Admin Tails USB and Workstation</h2>
<p>Earlier, you should have created the <em>admin Tails USB</em> along with a persistence volume for it. Now, we are going to add a couple more features to the <em>admin Tails USB</em> to facilitate SecureDrop's setup.</p>
<p>If you have not switched to and booted the <em>admin Tails USB</em> on your regular workstation, do so now.</p>
<h3 id="start-tails-and-enable-the-persistent-volume">Start Tails and enable the persistent volume</h3>
<p>After you boot the <em>admin Tails USB</em> on your normal workstation, you should see a <em>Welcome to Tails</em> screen with two options. Select <em>Yes</em> to enable the persistent volume and enter your password, but do NOT click Login yet. Under 'More Options," select <em>Yes</em> and click <em>Forward</em>.</p>
<p>Enter an <em>Administration password</em> for use with this specific Tails session and click <em>Login</em>. (NOTE: the <em>Administration password</em> is a one-time password. It will reset every time you shut down Tails.)</p>
<p>After Tails is fully booted, make sure you're connected to the Internet <img alt="Network" src="../images/network-wired.png" /> and that the Tor's Vidalia indicator onion <img alt="Vidalia" src="../images/vidalia.png" /> is green, using the icons in the upper right corner.</p>
<h3 id="download-the-securedrop-repository">Download the SecureDrop repository</h3>
<p>The rest of the SecureDrop-specific configuration is assisted by files stored in the SecureDrop Git repository. We're going to be using this again once SecureDrop is installed, but you should download it now. To get started, open a terminal <img alt="Terminal" src="../images/terminal.png" />. You will use this Terminal throughout the rest of the install process.</p>
<p>Start by running the following commands to download the git repository.</p>
<p>NOTE: Since the repository is fairly large and Tor can be slow, this may take a few minutes.</p>
<pre><code class="sh">cd ~/Persistent
git clone https://github.com/freedomofpress/securedrop.git
</code></pre>

<p>Before proceeding, verify the signed git tag for this release.</p>
<p>First, download the <em>Freedom of the Press Foundation Master Signing Key</em> and verify the fingerprint.</p>
<pre><code>gpg --keyserver pool.sks-keyservers.net --recv-key B89A29DB2128160B8E4B1B4CBADDE0C7FC9F6818
gpg --fingerprint B89A29DB2128160B8E4B1B4CBADDE0C7FC9F6818
</code></pre>
<p>The Freedom of the Press Foundation Master Signing Key should have a fingerprint of "B89A 29DB 2128 160B 8E4B  1B4C BADD E0C7 FC9F 6818". If the fingerprint does not match, fingerprint verification has failed and you <em>should not</em> proceed with the installation. If this happens, please contact us at securedrop@freedom.press.</p>
<p>Verify that the current release tag was signed with the master signing key.</p>
<pre><code>cd securedrop/
git checkout 0.3.4
git tag -v 0.3.4
</code></pre>
<p>You should see 'Good signature from "Freedom of the Press Foundation Master Signing Key"' in the output of <code>git tag</code>. If you do not, signature verification has failed and you <em>should not</em> proceed with the installation. If this happens, please contact us at securedrop@freedom.press.</p>
<h3 id="passphrase-database">Passphrase Database</h3>
<p>We provide a KeePassX password database template to make it easier for admins and journalists to generate strong, unique passphrases and store them securely. Once you have set up Tails with persistence and have cloned the repo, you can set up your personal password database using this template.</p>
<p>You can find the template in <code>/Persistent/securedrop/tails_files/securedrop-keepassx.xml</code> within the SecureDrop repository. Note that you will not be able to access your passwords if you forget the master password or the location of the key file used to protect the database.</p>
<p>To use the template:</p>
<ul>
<li>Open the KeePassX program <img alt="KeePassX" src="../images/keepassx.png" /> which is already installed on Tails</li>
<li>Select <code>File</code>, <code>Import from...</code>, and <code>KeePassX XML (*.xml)</code></li>
<li>Navigate to the location of <code>securedrop-keepassx.xml</code>, select it, and click <code>Open</code></li>
<li>Set a strong master password to protect the password database (you will have to write this down/memorize it)</li>
<li>Click <code>File</code> and <code>Save Database As</code></li>
<li>Save the database in the Persistent folder</li>
</ul>
<h2 id="set-up-the-network-firewall">Set up the Network Firewall</h2>
<p>Now that you've set up your password manager, you can move on to setting up the Network Firewall. You should stay logged in to your <em>admin Tails USB</em>, but please go to our <a href="../network_firewall/">Network Firewall Guide</a> for instructions for setting up the Network Firewall. When you are done, you will be sent back here to continue with the next section.</p>
<h2 id="set-up-the-servers">Set up the Servers</h2>
<p>Now that the firewall is set up, you can plug the <em>Application Server</em> and the <em>Monitor Server</em> into the firewall. If you are using a setup where there is a switch on the LAN port, plug the <em>Application Server</em> into the switch and plug the <em>Monitor Server</em> into the OPT1 port.</p>
<p>Install Ubuntu Server 14.04 (Trusty) on both servers. This setup is fairly easy, but please note the following:</p>
<ul>
<li>Since the firewall is configured to give the servers a static IP address, you will have to manually configure the network with those values.</li>
<li>The hostname for the servers are, conventionally, <code>app</code> and <code>mon</code>.  Adhering to this isn't necessary, but it will make the rest of your install easier.</li>
<li>The username and password for these two servers <strong>must be the same</strong>.</li>
</ul>
<p>For detailed instructions on installing and configuring Ubuntu for use with SecureDrop, see our <a href="../ubuntu_config/">Ubuntu Install Guide</a>.</p>
<p>When you are done, make sure you save the following information:</p>
<ul>
<li>The IP address of the App Server</li>
<li>The IP address of the Monitor Server</li>
<li>The non-root user's name and password for the servers.</li>
</ul>
<p>Before continuing, you'll also want to make sure you can connect to the App and Monitor servers. You should still have the Admin Workstation connected to the firewall from the firewall setup step. In the terminal, verify that you can SSH into both servers, authenticating with your password:</p>
<pre><code class="sh">ssh &lt;username&gt;@&lt;App IP address&gt;
ssh &lt;username&gt;@&lt;Monitor IP address&gt;
</code></pre>

<p>Once you have verified that you can connect, continue with the installation. If you cannot connect, check the firewall logs.</p>
<h2 id="install-the-securedrop-application">Install the SecureDrop application</h2>
<h3 id="install-ansible">Install Ansible</h3>
<p>You should still be on your admin workstation with your <em>admin Tails USB</em>.</p>
<p>Next you need to install Ansible. To do this, you first need to update your package manager's package lists to be sure you get the latest version of Ansible. It should take a couple minutes.</p>
<pre><code>sudo apt-get update
</code></pre>
<p>Now, install Ansible by entering this command:</p>
<pre><code>sudo apt-get install ansible
</code></pre>
<h3 id="set-up-ssh-keys-for-the-admin">Set up SSH keys for the Admin</h3>
<p>Now that you've verified the code that's needed for installation, you need to create an SSH key on the Admin Workstation. Initially, Ubuntu has SSH configured to authenticate users with their password. This new key will be copied to the <em>Application Server</em> and the <em>Monitor Server</em>, and will replace the use of the password for authentication. Since the Admin Live USB was set up with <a href="https://tails.boum.org/doc/first_steps/persistence/configure/index.en.html#index3h2">SSH Client persistence</a>, this key will be saved on the Admin Live USB and can be used in the future to authenticate to the servers in order to perform administrative tasks.</p>
<p>First, generate the new SSH keypair:</p>
<pre><code>$ ssh-keygen -t rsa -b 4096
</code></pre>
<p>You'll be asked to "enter file in which to save the key." Here you can just keep the default, so type enter. </p>
<p>If you choose to passphrase-protect this key, you must use a strong, diceword-generated, passphrase that you can manually type (as Tails' pinentry will not allow you to copy and paste a passphrase).  It is also acceptable to leave the passphrase blank in this case.</p>
<p>Once the key has finished generating, you need to copy the public key to both servers. Use <code>ssh-copy-id</code> to copy the public key to each server in turn. Use the user name and password that you set up during Ubuntu installation.</p>
<pre><code>$ ssh-copy-id &lt;username&gt;@&lt;App IP address&gt;
$ ssh-copy-id &lt;username&gt;@&lt;Mon IP address&gt;
</code></pre>
<p>Verify that you are able to authenticate to both servers by running the below commands (you will be prompted for the SSH password you just created).</p>
<pre><code class="sh">ssh &lt;username&gt;@&lt;App IP address&gt; hostname
ssh &lt;username&gt;@&lt;Montior IP address&gt; hostname
</code></pre>

<p>Make sure to run the 'exit' command after testing each one.</p>
<h3 id="gather-the-required-information">Gather the required information</h3>
<p>Make sure you have the following information and files before continuing:</p>
<ul>
<li>The <em>App Server</em> IP address</li>
<li>The <em>Monitor Server</em> IP address</li>
<li>The SecureDrop application's GPG public key (from the <em>Transfer Device</em>)</li>
<li>The SecureDrop application's GPG key fingerprint</li>
<li>The email address that will receive alerts from OSSEC</li>
<li>The GPG public key and fingerprint for the email address that will receive the alerts</li>
<li>Connection information for the SMTP relay that handles OSSEC alerts. For more information, see the <a href="../ossec_alerts/">OSSEC Alerts Guide</a>.</li>
<li>The first username of a journalist who will be using SecureDrop (you can add more later)</li>
<li>The username of the system administrator</li>
<li>(Optional) An image to replace the SecureDrop logo on the <em>Source Interface</em> and <em>Document Interface</em><ul>
<li>Recommended size: <code>500px x 450px</code></li>
<li>Recommended format: PNG</li>
</ul>
</li>
</ul>
<h3 id="install-securedrop">Install SecureDrop</h3>
<p>From the base of the SecureDrop repo, change into the <code>ansible-base</code> directory:</p>
<pre><code>$ cd install_files/ansible-base
</code></pre>
<p>You will have to copy the following required files to <code>install_files/ansible-base</code>:</p>
<ul>
<li>SecureDrop Application GPG public key file</li>
<li>Admin GPG public key file (for encrypting OSSEC alerts)</li>
<li>(Optional) Custom header image file</li>
</ul>
<p>The SecureDrop application GPG key should be located on your <em>Transfer Device</em> from earlier. It will depend on the location where the USB stick is mounted, but for example, if you are already in the ansible-base directory, you can just run:</p>
<pre><code>$ cp /media/[USB folder]/SecureDrop.asc .
</code></pre>
<p>Or you may use the copy and paste capabilities of the file manager. Repeat this step for the Admin GPG key and custom header image.</p>
<p>Now you must edit a couple configuration files. You can do so using gedit, vim, or nano. Double-clicking will suffice to open them.</p>
<p>Edit the inventory file, <code>inventory</code>, and update the default IP addresses with the ones you chose for app and mon. When you're done, save the file.</p>
<p>Edit the file <code>prod-specific.yml</code> and fill it out with values that match your environment. At a minimum, you will need to provide the following:</p>
<ul>
<li>User allowed to connect to both servers with SSH: <code>ssh_users</code></li>
<li>IP address of the Monitor Server: <code>monitor_ip</code></li>
<li>Hostname of the Monitor Server: <code>monitor_hostname</code></li>
<li>Hostname of the Application Server: <code>app_hostname</code></li>
<li>IP address of the Application Server: <code>app_ip</code></li>
<li>The SecureDrop application's GPG public key: <code>securedrop_app_gpg_public_key</code></li>
<li>The SecureDrop application's GPG key fingerprint: <code>securedrop_app_gpg_fingerprint</code></li>
<li>GPG public key used when encrypting OSSEC alerts: <code>ossec_alert_gpg_public_key</code></li>
<li>Fingerprint for key used when encrypting OSSEC alerts: <code>ossec_gpg_fpr</code></li>
<li>The email address that will receive alerts from OSSEC: <code>ossec_alert_email</code></li>
<li>The reachable hostname of your SMTP relay: <code>smtp_relay</code></li>
<li>The secure SMTP port of your SMTP relay: <code>smtp_relay_port</code> (typically 25, 587, or 465. Must support TLS encryption)</li>
<li>Email username to authenticate to the SMTP relay: <code>sasl_username</code></li>
<li>Domain name of the email used to send OSSEC alerts: <code>sasl_domain</code></li>
<li>Password of the email used to send OSSEC alerts: <code>sasl_password</code></li>
<li>The fingerprint of your SMTP relay (optional): <code>smtp_relay_fingerprint</code></li>
</ul>
<p>When you're done, save the file and quit the editor.</p>
<p>Now you are ready to run the playbook! This will automatically configure the servers and install SecureDrop and all of its dependencies. <code>&lt;username&gt;</code> below is the user you created during the Ubuntu installation, and should be the same user you copied the SSH public keys to.</p>
<pre><code>$ ansible-playbook -i inventory -u &lt;username&gt; -K --sudo securedrop-prod.yml
</code></pre>
<p>You will be prompted to enter the sudo password for the app and monitor servers (which should be the same).</p>
<p>The Ansible playbook will run, installing SecureDrop plus configuring and hardening the servers. This will take some time, and it will return the terminal to you when it is complete. If an error occurs while running the playbook, please submit a detailed <a href="https://github.com/freedomofpress/securedrop/issues/new">GitHub issue</a> or send an email to securedrop@freedom.press.</p>
<p>Once the installation is complete, the addresses for each Tor Hidden Service will be available in the following files in <code>install_files/ansible-base</code>:</p>
<ul>
<li><code>app-source-ths</code>: This is the .onion address of the Source Interface</li>
<li><code>app-document-aths</code>: This is the <code>HidServAuth</code> configuration line for the Document Interface. During a later step, this will be automatically added to your Tor configuration file in order to exclusively connect to the hidden service.</li>
<li><code>app-ssh-aths</code>: Same as above, for SSH access to the Application Server.</li>
<li><code>mon-ssh-aths</code>: Same as above, for SSH access to the Monitor Server.</li>
</ul>
<p>Update the inventory, replacing the IP addresses with the corresponding onion addresses from <code>app-ssh-aths</code> and <code>mon-ssh-aths</code>. This will allow you to re-run the Ansible playbooks in the future, even though part of SecureDrop's hardening restricts SSH to only being over the specific authenticated Tor Hidden Services.</p>
<h3 id="set-up-access-to-the-authenticated-hidden-services">Set up access to the authenticated hidden services</h3>
<p>To complete setup of the Admin Workstation, we recommend using the scripts in <code>tails_files</code> to easily and persistently configure Tor to access these hidden services.</p>
<p>Navigate to the directory with these scripts and type these commands into the terminal:</p>
<pre><code>cd ~/Persistent/securedrop/tails_files/
sudo ./install.sh
</code></pre>

<p>Type the administration password that you selected when starting Tails and hit enter. The installation process will download additional software and then open a text editor with a file called <em>torrc_additions</em>.</p>
<p>Edit this file, inserting the <em>HidServAuth</em> information for the three authenticated hidden services that you just received. You can double-click or use the 'cat' command to read the values from <code>app-document-aths</code>, <code>app-ssh-aths</code> and <code>mon-ssh-aths</code>. This information includes the address of the Document Interface, each server's SSH daemon and your personal authentication strings, like in the example below:</p>
<pre><code># add HidServAuth lines here
HidServAuth gu6yn2ml6ns5qupv.onion Us3xMTN85VIj5NOnkNWzW # client: user
HidServAuth fsrrszf5qw7z2kjh.onion xW538OvHlDUo5n4LGpQTNh # client: admin
HidServAuth yt4j52ajfvbmvtc7.onion vNN33wepGtGCFd5HHPiY1h # client: admin
</code></pre>

<p>An easy way to do this is to run <code>cat *-aths</code> from the <code>install_files/ansible-base</code> folder in a terminal window, and copy/paste the output into the opened text editor.</p>
<p>When you are done, click <em>Save</em> and <strong>close</strong> the text editor. Once the editor is closed, the install script will automatically resume.</p>
<p>Running <code>install.sh</code> sets up an initialization script that automatically updates Tor's configuration to work with the authenticated hidden services every time you login to Tails. As long as Tails is booted with the persistent volume enabled then you can open the Tor Browser and reach the Document Interface as normal, as well as connect to both servers via secure shell. Tor's <a href="https://www.torproject.org/docs/tor-manual.html.en#HiddenServiceAuthorizeClient">hidden service authentication</a> restricts access to only those who have the 'HidServAuth' values.</p>
<h3 id="set-up-ssh-host-aliases">Set up SSH host aliases</h3>
<p>This step is optional but makes it much easier to connect to and administer the servers. Create the file <code>/home/amnesia/.ssh/config</code> and add a configuration following the scheme below, but replace <code>Hostname</code> and <code>User</code> with the values specific to your setup:</p>
<pre><code>Host app
  Hostname fsrrszf5qw7z2kjh.onion
  User &lt;ssh_user&gt;
Host mon
  Hostname yt4j52ajfvbmvtc7.onion
  User &lt;ssh_user&gt;
</code></pre>

<p>Now you can simply use <code>ssh app</code> and <code>ssh mon</code> to connect to each server, and it will be stored in the Tails Dotfiles persistence.</p>
<h3 id="set-up-two-factor-authentication-for-the-admin">Set up two-factor authentication for the Admin</h3>
<p>As part of the SecureDrop installation process, you will need to set up two-factor authentication on the App Server and Monitor Server using the Google Authenticator mobile app.</p>
<p>After your torrc has been updated with the HidServAuth values, connect to the App Server using <code>ssh</code> and run <code>google-authenticator</code>. Follow the instructions in <a href="google_authenticator.md">our Google Authenticator guide</a> to set up the app on your Android or iOS device.</p>
<p>To disconnect enter the command <code>exit</code>. Now do the same thing on the Monitor Server. You'll end up with an account for each server in the Google Authenticator app that generates two-factor codes needed for logging in.</p>
<h3 id="create-users-for-the-web-application">Create users for the web application</h3>
<p>Now SSH to the App Server, <code>sudo su</code>, cd to /var/www/securedrop, and run <code>./manage.py add_admin</code> to create the first admin user for yourself. Make a password and store it in your KeePassX database. This admin user is for the SecureDrop Admin + Document Interface and will allow you to create accounts for the journalists.</p>
<p>The <code>add_admin</code> command will require you to keep another two-factor authentication code. Once that's done, you should open the Tor Browser <img alt="TorBrowser" src="../images/torbrowser.png" /> and navigate to the Document Interface's .onion address.</p>
<p>For adding journalist users, please refer now to our <a href="admin_interface.md">Admin Interface Guide</a>.</p>
<h2 id="finalizing-the-installation">Finalizing the Installation</h2>
<p>Some of the final configuration is included in these testing steps, so <em>do not skip them!</em></p>
<h3 id="test-the-web-application-and-connectivity">Test the web application and connectivity</h3>
<ol>
<li>SSH to both servers over Tor</li>
<li>As an admin running Tails with the proper HidServAuth values in your <code>/etc/torrc</code> file, you should be able to SSH directly to the App Server and Monitor Server.</li>
<li>Post-install you can now SSH <em>only</em> over Tor, so use the onion URLs from app-ssh-aths and mon-ssh-aths and the user created during the Ubuntu installation i.e. <code>ssh &lt;username&gt;@m5apx3p7eazqj3fp.onion</code>.</li>
<li>Make sure the Source Interface is available, and that you can make a submission.</li>
<li>Do this by opening the Tor Browser and navigating to the onion URL from <code>app-source-ths</code>. Proceed through the codename generation (copy this down somewhere) and you can submit a message or attach any random unimportant file.</li>
<li>Usage of the Source Interface is covered by our <a href="source_user_manual.md">Source User Manual</a>.</li>
<li>Test that you can access the Document Interface, and that you can log in as the admin user you just created.</li>
<li>Open the Tor Browser and navigate to the onion URL from app-document-aths. Enter your password and two-factor authentication code to log in.</li>
<li>If you have problems logging in to the Admin/Document Interface, SSH to the App Server and restart the ntp daemon to synchronize the time: <code>sudo service ntp restart</code>. Also check that your smartphone's time is accurate and set to network time in its device settings.</li>
<li>Test replying to the test submission.</li>
<li>While logged in as an admin, you can send a reply to the test source submission you made earlier.</li>
<li>Usage of the Document Interface is covered by our <a href="journalist_user_manual.md">Journalist User Manual</a>.</li>
<li>Test that the source received the reply.</li>
<li>Within Tor Browser, navigate back to the app-source-ths URL and use your previous test source codename to log in (or reload the page if it's still open) and check that the reply you just made is present.</li>
<li>We highly recommend that you create persistent bookmarks for the Source and Document Interface addresses within Tor Browser.</li>
<li>Remove the test submissions you made prior to putting SecureDrop to real use. On the main Document Interface page, select all sources and click 'Delete selected'.</li>
</ol>
<p>Once you've tested the installation and verified that everything is working, see <a href="journalist_user_manual.md">How to Use SecureDrop</a>.</p>
<h3 id="additional-testing">Additional testing</h3>
<ol>
<li>On each server, check that you can execute privileged commands by running <code>sudo su</code>.</li>
<li>Run <code>uname -r</code> to verify you are booted into grsecurity kernel. The string <code>grsec</code> should be in the output.</li>
<li>Check the AppArmor status on each server with <code>sudo aa-status</code>. On a production instance all profiles should be in enforce mode.</li>
<li>Check the current applied iptables rules with <code>iptables-save</code>. It should output <em>approximately</em> 50 lines.</li>
<li>You should have received an email alert from OSSEC when it first started. If not, review our <a href="../ossec_alerts/">OSSEC Alerts Guide</a>.</li>
</ol>
<p>If you have any feedback on the installation process, please let us know! We're always looking for ways to improve, automate and make things easier.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>